<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard NPS - Analyse Interactive</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header avec bouton Data -->
        <header class="header">
            <h1>ğŸ“Š Dashboard NPS - Analyse Interactive</h1>
            <p class="subtitle">Analyse approfondie des retours clients avec IA</p>
            <button id="dataBtn" class="btn-data">ğŸ“‚ Data</button>
        </header>

        <!-- Modal Upload (Hidden by default) -->
        <div class="modal-overlay" id="uploadModal" style="display: none;">
            <div class="modal-content">
                <button class="modal-close" id="closeModal">âœ•</button>
                <h2>ğŸ”’ Import des donnÃ©es</h2>
                
                <!-- Password Protection -->
                <div id="passwordSection">
                    <div class="password-input-group">
                        <input type="password" id="passwordInput" placeholder="Entrez le mot de passe..." class="password-input">
                        <button id="unlockBtn" class="btn-unlock">DÃ©verrouiller</button>
                    </div>
                    <p class="password-hint">ğŸ”‘ Mot de passe requis pour accÃ©der aux donnÃ©es</p>
                </div>

                <!-- Upload Section (Hidden until password is correct) -->
                <div id="uploadSection" style="display: none;">
                    <div class="upload-grid">
                        <div class="upload-box">
                            <label for="compoFile" class="upload-label">
                                <span class="upload-icon">ğŸ“‹</span>
                                <span class="upload-text">Fichier Compo (Logs)</span>
                                <span class="upload-hint">Glissez ou cliquez</span>
                            </label>
                            <input type="file" id="compoFile" accept=".xlsx,.xls" class="file-input">
                            <div class="file-status" id="compoStatus"></div>
                        </div>
                        <div class="upload-box">
                            <label for="npsFile" class="upload-label">
                                <span class="upload-icon">ğŸ“ˆ</span>
                                <span class="upload-text">Fichier NPS (Exportation)</span>
                                <span class="upload-hint">Glissez ou cliquez</span>
                            </label>
                            <input type="file" id="npsFile" accept=".xlsx,.xls" class="file-input">
                            <div class="file-status" id="npsStatus"></div>
                        </div>
                    </div>
                    <button id="processBtn" class="btn-primary" disabled>Analyser les donnÃ©es</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section (Visible by default, shows message until data loaded) -->
        <section class="dashboard-section" id="dashboardSection">
            
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">ğŸ“Š</div>
                <h2>Aucune donnÃ©e chargÃ©e</h2>
                <p>Cliquez sur le bouton <strong>"ğŸ“‚ Data"</strong> en haut Ã  droite pour importer vos fichiers Excel</p>
            </div>

            <!-- Data Loaded Section (Hidden until data is processed) -->
            <div id="dataSection" style="display: none;">
                
                <!-- Filters -->
                <div class="filters-card">
                    <h2>ğŸ” Filtres intelligents <span style="font-size: 0.8rem; opacity: 0.7;">(Optionnel)</span></h2>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>ğŸ”‘ Log Agent</label>
                            <input type="text" id="filterLog" placeholder="Rechercher un log..." class="filter-input">
                            <div id="logSuggestions" class="suggestions"></div>
                        </div>
                        <div class="filter-group">
                            <label>ğŸ‘¤ Nom/PrÃ©nom Agent</label>
                            <input type="text" id="filterAgent" placeholder="Rechercher un agent..." class="filter-input">
                            <div id="agentSuggestions" class="suggestions"></div>
                        </div>
                        <div class="filter-group">
                            <label>ğŸ‘¥ Encadrants (TL)</label>
                            <div id="filterTL" class="checkbox-group"></div>
                        </div>
                        <div class="filter-group">
                            <label>ğŸ¯ CompÃ©tences</label>
                            <div id="filterCompetence" class="checkbox-group"></div>
                        </div>
                        <div class="filter-group">
                            <label>ğŸ“… Statut Agent</label>
                            <select id="filterDateType" class="filter-select">
                                <option value="all">Tous les agents</option>
                                <option value="active">Agents actifs uniquement</option>
                                <option value="after">DÃ©mission aprÃ¨s le...</option>
                                <option value="before">DÃ©mission avant le...</option>
                            </select>
                            <input type="date" id="filterDate" class="filter-input" style="display: none;">
                        </div>
                        <div class="filter-group">
                            <label>ğŸ“† PÃ©riode NPS</label>
                            <input type="month" id="filterPeriod" class="filter-input">
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button id="resetFilters" class="btn-secondary">ğŸ” RÃ©initialiser</button>
                        <button id="exportCSV" class="btn-export">ğŸ“¥ Exporter CSV</button>
                    </div>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-grid" id="kpiGrid">
                    <div class="kpi-card">
                        <div class="kpi-icon">ğŸ“Š</div>
                        <div class="kpi-content">
                            <h3>NPS Global</h3>
                            <div class="kpi-value" id="npsGlobal">-</div>
                            <div class="kpi-trend" id="npsTrend"></div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">ğŸ“</div>
                        <div class="kpi-content">
                            <h3>Nb EnquÃªtes</h3>
                            <div class="kpi-value" id="nbSurveys">-</div>
                            <div class="kpi-detail" id="surveyDetail"></div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">âœ…</div>
                        <div class="kpi-content">
                            <h3>Taux RÃ©solution</h3>
                            <div class="kpi-value" id="resolutionRate">-</div>
                            <div class="kpi-detail" id="resolutionDetail"></div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-icon">ğŸ“ˆ</div>
                        <div class="kpi-content">
                            <h3>Ã‰volution</h3>
                            <div class="kpi-value" id="evolution">-</div>
                            <div class="kpi-detail" id="evolutionDetail"></div>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>ğŸ“ˆ Ã‰volution du NPS</h3>
                        <canvas id="npsEvolutionChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ‘¥ NPS par Encadrant (Top/Bottom 10)</h3>
                        <canvas id="npsByTLChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ¯ NPS par CompÃ©tence</h3>
                        <canvas id="npsByCompetenceChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ“Š Distribution des Scores</h3>
                        <canvas id="scoreDistributionChart"></canvas>
                    </div>
                </div>

                <!-- Verbatim Analysis -->
                <div class="analysis-card" id="analysisCard">
                    <h2>ğŸ¤– Analyse IA des Verbatims</h2>
                    
                    <!-- API Config inline -->
                    <div class="api-config-inline">
                        <div class="api-option">
                            <input type="radio" id="apiOpenAI" name="apiChoice" value="openai" checked>
                            <label for="apiOpenAI">OpenAI GPT-4</label>
                            <input type="text" id="openaiKey" placeholder="sk-..." class="api-input">
                        </div>
                        <div class="api-option">
                            <input type="radio" id="apiGemini" name="apiChoice" value="gemini">
                            <label for="apiGemini">Google Gemini</label>
                            <input type="text" id="geminiKey" placeholder="AIza..." class="api-input">
                        </div>
                    </div>
                    
                    <button id="analyzeBtn" class="btn-primary">Lancer l'analyse IA</button>
                    <div id="analysisResults" class="analysis-results" style="display: none;">
                        <div class="analysis-section">
                            <h3>ğŸ¯ ThÃ¨mes principaux</h3>
                            <div id="themes"></div>
                        </div>
                        <div class="analysis-section">
                            <h3>âš ï¸ Points faibles identifiÃ©s</h3>
                            <div id="weaknesses"></div>
                        </div>
                        <div class="analysis-section">
                            <h3>ğŸ“‹ Plan d'action 30/60/90 jours</h3>
                            <div id="actionPlan"></div>
                        </div>
                        <div class="analysis-section">
                            <h3>ğŸ·ï¸ Tags des verbatims</h3>
                            <div id="tags"></div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Table -->
                <div class="table-card">
                    <h2>ğŸ“‹ DÃ©tail par Agent</h2>
                    <div class="table-controls">
                        <input type="text" id="tableSearch" placeholder="Rechercher dans la table..." class="table-search">
                        <select id="tableSort" class="table-sort">
                            <option value="nps-desc">NPS (dÃ©croissant)</option>
                            <option value="nps-asc">NPS (croissant)</option>
                            <option value="surveys-desc">Nb EnquÃªtes (dÃ©croissant)</option>
                            <option value="agent-asc">Agent (A-Z)</option>
                        </select>
                    </div>
                    <div class="table-wrapper">
                        <table id="detailTable">
                            <thead>
                                <tr>
                                    <th>Log</th>
                                    <th>Agent</th>
                                    <th>Encadrant</th>
                                    <th>CompÃ©tence</th>
                                    <th>NPS</th>
                                    <th>Nb EnquÃªtes</th>
                                    <th>Taux RÃ©solution</th>
                                    <th>Promoteurs</th>
                                    <th>Passifs</th>
                                    <th>DÃ©tracteurs</th>
                                    <th>Date Fin</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </section>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-spinner"></div>
            <p class="loading-text">Traitement en cours...</p>
        </div>

    </div>

    <script src="main.js"></script>
</body>
</html>
